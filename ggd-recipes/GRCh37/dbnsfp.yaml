---
attributes:
  name: dbnsfp
  version: 3.1c
recipe:
  full:
    recipe_type: bash
    recipe_cmds:
      - |
        baseurl=ftp://dbnsfp:dbnsfp@dbnsfp.softgenetics.com/dbNSFPv3.1c.zip
        mkdir -p variation
        cd variation
        wget -c -N $baseurl
        if [ ! -f dbNSFP.txt.gz ]; then
          unzip -d tmp-unpack dbNSFPv*.zip
          head -n1 tmp-unpack/dbNSFP*_variant.chr1 > dbNSFP.txt
          cat tmp-unpack/dbNSFP*_variant.chr* | grep -v ^# >> dbNSFP.txt
          bgzip dbNSFPv3.1c.txt tabix -s 1 -b 2 -e 2 dbNSFP.txt.gz        
        fi
        tabix -s 1 -b 2 -e 2 dbNSFP.txt.gz
        rm -f tmp-unpack/* && rmdir tmp-unpack
        rm -f dbNSFPv*.zip
    recipe_outfiles:
      - variation/dbNSFP.txt.gz
      - variation/dbNSFP.txt.gz.tbi
